<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwen Multi-Angle Camera Control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">‚¨°</span>
                <span class="logo-text">Qwen Multi-Angle</span>
            </div>
            <div class="api-key-section">
                <label for="api-key" class="api-label">fal.ai API Key <a href="https://fal.ai/dashboard/keys" target="_blank" class="get-key-link">(Get key)</a></label>
                <div class="api-input-wrapper">
                    <input 
                        type="password" 
                        id="api-key" 
                        placeholder="Enter your API key..." 
                        autocomplete="off"
                    >
                    <button id="toggle-key" class="toggle-key-btn" title="Show/Hide">
                        <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </button>
                </div>
                <span class="api-key-hint">üîí Stored only in your browser's local storage</span>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="single-image">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 2v4M12 18v4M2 12h4M18 12h4"/>
                </svg>
                Single-image
            </button>
            <button class="tab-btn" data-tab="multi-image">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 17l6-6 4 4 8-8"/>
                    <circle cx="7" cy="13" r="2"/>
                    <circle cx="11" cy="17" r="2"/>
                    <circle cx="19" cy="5" r="2"/>
                </svg>
                Multi-image
            </button>
            <button class="tab-btn" data-tab="camera-motion">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 7l-9 5-9-5 9-5 9 5z"/>
                    <path d="M3 7v10l9 5 9-5V7"/>
                </svg>
                Camera motion
            </button>
        </nav>

        <!-- Tab Panels -->
        <div class="tab-panels">
            <!-- ========== SINGLE ANGLE TAB ========== -->
            <div class="tab-panel active" id="single-image-panel">
                <main class="main-content">
                    <!-- Left Panel: Upload & 3D Control -->
                    <section class="left-panel">
                        <!-- Image Upload -->
                        <div class="panel-card upload-card">
                            <h3 class="card-title">Input Image</h3>
                            <div class="upload-zone" id="upload-zone">
                                <input type="file" id="image-input" accept="image/jpeg,image/jpg,image/png,image/webp,image/gif,.jpg,.jpeg,.png,.webp,.gif" hidden>
                                <div class="upload-placeholder" id="upload-placeholder">
                                    <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="17 8 12 3 7 8"/>
                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                    </svg>
                                    <p>Drop image here or click to upload</p>
                                </div>
                                <img id="preview-image" class="preview-image hidden" alt="Preview">
                                <button id="clear-image" class="clear-btn hidden">√ó</button>
                            </div>
                            <div class="url-input-section">
                                <div class="url-divider"><span>or paste URL</span></div>
                                <div class="url-input-wrapper">
                                    <input type="text" id="image-url-input" placeholder="https://example.com/image.jpg" autocomplete="off">
                                    <button id="load-url-btn" class="load-url-btn">Load</button>
                                </div>
                            </div>
                        </div>

                        <!-- 3D Camera Control -->
                        <div class="panel-card camera-card">
                            <h3 class="card-title">3D Camera Control</h3>
                            <p class="card-subtitle">Drag handles: <span class="handle-azimuth">‚óè</span> Azimuth <span class="handle-elevation">‚óè</span> Elevation <span class="handle-distance">‚óè</span> Distance</p>
                            <div id="threejs-container" class="threejs-container"></div>
                        </div>

                        <!-- Sliders -->
                        <div class="panel-card sliders-card">
                            <h3 class="card-title">Manual Controls</h3>
                            
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Azimuth (Horizontal)</label>
                                    <span id="azimuth-value" class="slider-value">0¬∞</span>
                                </div>
                                <input type="range" id="azimuth-slider" min="0" max="360" step="1" value="0">
                                <div class="slider-labels">
                                    <span>0¬∞</span>
                                    <span>90¬∞</span>
                                    <span>180¬∞</span>
                                    <span>270¬∞</span>
                                    <span>360¬∞</span>
                                </div>
                            </div>

                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Elevation (Vertical Angle)</label>
                                    <span id="elevation-value" class="slider-value">0¬∞</span>
                                </div>
                                <input type="range" id="elevation-slider" min="-30" max="90" step="1" value="0">
                                <div class="slider-labels">
                                    <span>-30¬∞ (Low)</span>
                                    <span>0¬∞ (Eye)</span>
                                    <span>90¬∞ (Bird)</span>
                                </div>
                            </div>

                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Zoom (Distance)</label>
                                    <span id="distance-value" class="slider-value">5</span>
                                </div>
                                <input type="range" id="distance-slider" min="0" max="10" step="0.1" value="5">
                                <div class="slider-labels">
                                    <span>0 (Wide)</span>
                                    <span>5 (Medium)</span>
                                    <span>10 (Close)</span>
                                </div>
                            </div>
                        </div>

                        <!-- API Parameters Preview -->
                        <div class="panel-card prompt-card">
                            <h3 class="card-title">API Parameters</h3>
                            <div class="prompt-display" id="prompt-display">
                                Loading...
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <button id="generate-btn" class="generate-btn" disabled>
                            <span class="btn-text">Generate</span>
                            <span class="btn-loader hidden">
                                <svg class="spinner" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="31.4" stroke-dashoffset="10"/>
                                </svg>
                            </span>
                        </button>
                    </section>

                    <!-- Right Panel: Output -->
                    <section class="right-panel">
                        <div class="panel-card output-card">
                            <h3 class="card-title">Output</h3>
                            <div class="output-container" id="output-container">
                                <div class="output-placeholder" id="output-placeholder">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <circle cx="8.5" cy="8.5" r="1.5"/>
                                        <polyline points="21 15 16 10 5 21"/>
                                    </svg>
                                    <p>Generated image will appear here</p>
                                </div>
                                <img id="output-image" class="output-image hidden" alt="Output">
                            </div>
                            <button id="download-btn" class="download-btn hidden">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download
                            </button>
                        </div>

                        <!-- Status/Error Display -->
                        <div id="status-message" class="status-message hidden"></div>

                        <!-- Logs Panel -->
                        <details class="logs-panel" open>
                            <summary class="logs-header">
                                <span>üîß Debug Logs</span>
                                <button id="clear-logs" class="clear-logs-btn">Clear</button>
                            </summary>
                            <div id="logs-container" class="logs-container">
                                <div class="log-entry info">Ready. Waiting for API call...</div>
                            </div>
                        </details>
                    </section>
                </main>
            </div>

            <!-- ========== CAMERA PATH TAB ========== -->
            <div class="tab-panel" id="multi-image-panel">
                <main class="main-content path-content">
                    <!-- Left Panel: Path Drawing -->
                    <section class="left-panel">
                        <!-- Image Upload for Path -->
                        <div class="panel-card upload-card">
                            <h3 class="card-title">Input Image</h3>
                            <div class="upload-zone" id="path-upload-zone">
                                <input type="file" id="path-image-input" accept="image/jpeg,image/jpg,image/png,image/webp,image/gif,.jpg,.jpeg,.png,.webp,.gif" hidden>
                                <div class="upload-placeholder" id="path-upload-placeholder">
                                    <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="17 8 12 3 7 8"/>
                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                    </svg>
                                    <p>Drop image here or click to upload</p>
                                </div>
                                <img id="path-preview-image" class="preview-image hidden" alt="Preview">
                                <button id="path-clear-image" class="clear-btn hidden">√ó</button>
                            </div>
                            <div class="url-input-section">
                                <div class="url-divider"><span>or paste URL</span></div>
                                <div class="url-input-wrapper">
                                    <input type="text" id="path-image-url-input" placeholder="https://example.com/image.jpg" autocomplete="off">
                                    <button id="path-load-url-btn" class="load-url-btn">Load</button>
                                </div>
                            </div>
                        </div>

                        <!-- 3D Path Drawing -->
                        <div class="panel-card camera-card">
                            <h3 class="card-title">3D Camera Path</h3>
                            <p class="card-subtitle">Hover sphere to preview, scroll to set zoom, click to add waypoint (2-4 points). <span id="placement-zoom-label" style="margin-left:8px; color: var(--accent); font-family: var(--font-mono);">Zoom: 5.0</span></p>
                            <div id="path-threejs-container" class="threejs-container"></div>
                            <div class="path-controls">
                                <button id="clear-waypoints-btn" class="secondary-btn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                    </svg>
                                    Clear All
                                </button>
                                <button id="undo-waypoint-btn" class="secondary-btn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 10h10a5 5 0 015 5v2M3 10l4-4M3 10l4 4"/>
                                    </svg>
                                    Undo
                                </button>
                            </div>
                        </div>

                        <!-- Waypoints List -->
                        <div class="panel-card waypoints-card">
                            <h3 class="card-title">Waypoints <span id="waypoint-count" class="waypoint-count">(0/4)</span></h3>
                            <div id="waypoints-list" class="waypoints-list">
                                <div class="waypoints-empty">
                                    <p>Click on the sphere above to add camera positions</p>
                                </div>
                            </div>
                        </div>

                        <!-- Generate Keyframes Button -->
                        <button id="generate-keyframes-btn" class="generate-btn" disabled>
                            <span class="btn-text">Generate All Keyframes</span>
                            <span class="btn-loader hidden">
                                <svg class="spinner" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="31.4" stroke-dashoffset="10"/>
                                </svg>
                            </span>
                        </button>
                        <div id="keyframe-progress" class="progress-container hidden">
                            <div class="progress-bar">
                                <div id="keyframe-progress-fill" class="progress-fill"></div>
                            </div>
                            <span id="keyframe-progress-text" class="progress-text">0/0</span>
                        </div>
                    </section>

                    <!-- Middle Panel: Gallery -->
                    <section class="middle-panel">
                        <div class="panel-card gallery-card">
                            <div class="gallery-header">
                                <h3 class="card-title">Generated Keyframes</h3>
                                <button id="download-all-btn" class="secondary-btn hidden">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    Download All (ZIP)
                                </button>
                            </div>
                            <div id="keyframes-gallery" class="keyframes-gallery">
                                <div class="gallery-empty">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <rect x="3" y="3" width="7" height="7"/>
                                        <rect x="14" y="3" width="7" height="7"/>
                                        <rect x="14" y="14" width="7" height="7"/>
                                        <rect x="3" y="14" width="7" height="7"/>
                                    </svg>
                                    <p>Generated keyframes will appear here</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Right Panel: Debug -->
                    <section class="right-panel">
                        <!-- Path Status/Error Display -->
                        <div id="path-status-message" class="status-message hidden"></div>

                        <!-- Path Logs Panel -->
                        <details class="logs-panel" open>
                            <summary class="logs-header">
                                <span>üîß Debug Logs</span>
                                <button id="path-clear-logs" class="clear-logs-btn">Clear</button>
                            </summary>
                            <div id="path-logs-container" class="logs-container">
                                <div class="log-entry info">Camera Path mode ready. Add waypoints to begin.</div>
                            </div>
                        </details>
                    </section>
                </main>
            </div>

            <!-- ========== CAMERA MOTION TAB ========== -->
            <div class="tab-panel" id="camera-motion-panel">
                <main class="main-content">
                    <section class="left-panel">
                        <div class="panel-card">
                            <h3 class="card-title">Camera Motion</h3>
                            <p class="card-subtitle">Generate video from the keyframes you created in Multi-image.</p>
                            <div class="ai-info">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4M12 8h.01"/>
                                </svg>
                                <span>Tip: Generate keyframes first in Multi-image, then come here to create camera motion video.</span>
                            </div>
                        </div>
                    </section>
                    <section class="right-panel">
                        <div class="panel-card video-card">
                            <h3 class="card-title">Create Camera Motion Video</h3>
                            <p class="card-subtitle">Quick Stitch is instant. AI Video uses Seedance (queued).</p>
                            <div class="video-mode-toggle">
                                <button class="mode-btn active" data-mode="quick">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="5 3 19 12 5 21 5 3"/>
                                    </svg>
                                    Quick Stitch
                                    <span class="mode-badge">Instant</span>
                                </button>
                                <button class="mode-btn" data-mode="ai">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2a4 4 0 014 4v1a4 4 0 01-8 0V6a4 4 0 014-4z"/>
                                        <path d="M12 14c-4 0-8 2-8 4v2h16v-2c0-2-4-4-8-4z"/>
                                    </svg>
                                    AI Video
                                    <span class="mode-badge ai">Seedance</span>
                                </button>
                            </div>

                            <div class="video-settings" id="quick-settings">
                                <div class="setting-row">
                                    <div class="setting-group">
                                        <label for="video-duration">Total Duration</label>
                                        <select id="video-duration">
                                            <option value="3">3 seconds</option>
                                            <option value="4">4 seconds</option>
                                            <option value="5" selected>5 seconds</option>
                                            <option value="6">6 seconds</option>
                                            <option value="8">8 seconds</option>
                                        </select>
                                    </div>
                                    <div class="setting-group">
                                        <label for="transition-style">Transition Style</label>
                                        <select id="transition-style">
                                            <option value="crane-zoom" selected>Crane Zoom</option>
                                            <option value="smooth-pan">Smooth Pan</option>
                                            <option value="whip-pan">Whip Pan</option>
                                            <option value="dolly-zoom">Dolly Zoom</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-row">
                                    <div class="setting-group">
                                        <label for="video-fps">Frame Rate</label>
                                        <select id="video-fps">
                                            <option value="24">24 fps (Cinematic)</option>
                                            <option value="30" selected>30 fps</option>
                                            <option value="60">60 fps (Smooth)</option>
                                        </select>
                                    </div>
                                    <div class="setting-group">
                                        <label for="ease-type">Easing</label>
                                        <select id="ease-type">
                                            <option value="ease-in-out" selected>Ease In-Out</option>
                                            <option value="ease-out">Ease Out</option>
                                            <option value="linear">Linear</option>
                                            <option value="bounce">Bounce</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="video-settings hidden" id="ai-settings">
                                <div class="setting-group">
                                    <label for="ai-video-model">AI Video Model</label>
                                    <select id="ai-video-model">
                                        <option value="seedance" selected>Seedance 1.5 Pro (start+end)</option>
                                        <option value="kling26">Kling v2.6 Standard (start+end)</option>
                                        <option value="veo31">Veo 3.1 Fast (first+last only)</option>
                                        <option value="ltx2">LTX-2 19B (image-only)</option>
                                    </select>
                                </div>
                                <div class="setting-group">
                                    <label for="ai-prompt">Motion Prompt</label>
                                    <textarea id="ai-prompt" rows="2">The camera very slowly and smoothly lowers on a boom. The subject moves barely moves, and is extremely deliberate and thoughtful in his movement.</textarea>
                                </div>
                                <div class="setting-group">
                                    <label for="ai-resolution">Resolution</label>
                                    <select id="ai-resolution">
                                        <option value="480p">480p (Faster)</option>
                                        <option value="720p" selected>720p</option>
                                    </select>
                                </div>
                                <div class="setting-group">
                                    <label for="ai-pair-seconds">Per-pair duration (after speedup)</label>
                                    <select id="ai-pair-seconds">
                                        <option value="1" selected>1 second (fast)</option>
                                        <option value="2">2 seconds (slower)</option>
                                        <option value="3">3 seconds (smooth)</option>
                                    </select>
                                </div>
                                <div class="setting-group">
                                    <label style="display:flex; align-items:center; gap:10px;">
                                        <input type="checkbox" id="ai-loop-path" style="transform: translateY(1px);">
                                        Loop back to start (adds last ‚Üí first)
                                    </label>
                                </div>
                            </div>

                            <button id="generate-video-btn" class="generate-btn video-btn" disabled>
                                <span class="btn-text">Create Video</span>
                                <span class="btn-loader hidden">
                                    <svg class="spinner" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="31.4" stroke-dashoffset="10"/>
                                    </svg>
                                </span>
                            </button>
                            <div id="video-progress" class="progress-container hidden">
                                <div class="progress-bar">
                                    <div id="video-progress-fill" class="progress-fill"></div>
                                </div>
                                <span id="video-progress-text" class="progress-text">Rendering...</span>
                            </div>
                        </div>

                        <div class="panel-card videos-card">
                            <h3 class="card-title">Final Video</h3>
                            <div id="video-preview-container" class="video-preview-container">
                                <div class="videos-empty" id="video-empty-state">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <polygon points="23 7 16 12 23 17 23 7"/>
                                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                                    </svg>
                                    <p>Generated video will appear here</p>
                                </div>
                                <video id="final-video" class="final-video hidden" controls loop></video>
                                <canvas id="video-canvas" class="hidden"></canvas>
                            </div>
                            <button id="download-video-btn" class="download-btn hidden">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download Video
                            </button>
                        </div>
                    </section>
                </main>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by <a href="https://fal.ai/models/fal-ai/qwen-image-edit-2511-multiple-angles/" target="_blank">fal.ai</a> | Video by <a href="https://fal.ai/models/fal-ai/bytedance/seedance/v1.5/pro/image-to-video/api" target="_blank">Seedance 1.5</a></p>
        </footer>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- JSZip for downloading multiple files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- fal.ai client -->
    <script type="module" src="app.js"></script>
</body>
</html>
